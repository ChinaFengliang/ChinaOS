/******************************************************Copyright (c)**************************************************
**
**                              Copyright (c) 2009,2011 Fengliang And His Friends Corporation.
**
**                                             E-Mail: ChinaFengliang@163.com
**
**
**---------File Information-------------------------------------------------------------------------------------------
** File name:            uart2.c
** Last version:         V1.00
** Descriptions:         uart2驱动文件.
** Hardware platform:    lpc2460
** SoftWare platform:    
**
**--------------------------------------------------------------------------------------------------------------------
** Created by:           FengLiang
** Created date:         2011年2月19日  21:23:48
** Version:              V1.00
** Descriptions:         The original version
**
**--------------------------------------------------------------------------------------------------------------------
** Modified by: 
** Modified date:
** Version:
** Descriptions:
**
*********************************************************************************************************************/

/*********************************************************************************************************************
                                                    头文件区
*********************************************************************************************************************/
#include    "../../../include/OS_macro.h"
#include    "../../../include/OS_types.h"
#include    "../../../include/lpc24xx.h"
#include    "../../../libuary/regist.h"
#include    "../uart.h"

/*********************************************************************************************************************
                                                    宏定义区
*********************************************************************************************************************/
/* 宏段名 ----------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                    类型定义区
*********************************************************************************************************************/
/* 基本类型 --------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                  全局变量定义区
*********************************************************************************************************************/
static const UART_INFO uart2_info =
{
    0xE0078000,                                                             /* 寄存器基址                           */
};


/*********************************************************************************************************************
** Function name:           uart2_setup
** Descriptions:            安装uart2设备
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  21:33:43
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static STATUS uart2_setup(int Speed)
{
    STATUS          Status;
    /* 1)
     * 私有构建过程
     */
    regist_set_bits(PCONP, 1ul<<24);                                        /* 使能uart2外设备供电                  */ 
    regist_modify(PCLKSEL1, 1ul<<17, 1ul<<16);                              /* 设置串口2分频系数: Fuart2 = Fcpu / 1 */
    regist_modify(PINSEL4, (1ul<<16)|(1ul<<18),                             /* 设置P2.7功能: RXD                    */
                           (1ul<<17)|(1ul<<19));                            /* 设置P2.8功能: TXD                    */
    /* 2)
     * 类构建过程
     */
    Status = uart_setup(&uart2_info, Speed);
    
    return Status;
}


/*********************************************************************************************************************
** Function name:           uart2_cleanup
** Descriptions:            卸载uart2设备
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:33:1
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static STATUS uart2_cleanup(void)
{
    regist_clr_bits(PCONP, 1ul<<24);                                        /* 禁能uart1外设备供电                  */
   
    return OS_OK;
}

/*********************************************************************************************************************
** Function name:           uart2_send
** Descriptions:            发送数据
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:40:50
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static INT32S uart2_send(char *pBuffer, int Size)
{
    uart_send(&uart2_info, pBuffer, Size);
    return OS_OK;
}

/*********************************************************************************************************************
** Function name:           uart2_recv
** Descriptions:            接收数据
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:42:13
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static INT32S uart2_recv(char *pBuffer, int Size)
{
    uart_recv(&uart2_info, pBuffer, Size);
    return OS_OK;
}

/*********************************************************************************************************************
                                                    设备定义区
*********************************************************************************************************************/
const CLASS_UART        uart2 =                                             /* 设备: uart2                          */
{
    uart2_setup,
    uart2_cleanup,
    uart2_send,
    uart2_recv
};

/*********************************************************************************************************************
                                                    END OF FILE
*********************************************************************************************************************/

