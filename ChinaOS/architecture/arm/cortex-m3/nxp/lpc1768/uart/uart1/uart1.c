/******************************************************Copyright (c)**************************************************
**
**                              Copyright (c) 2009,2011 Fengliang And His Friends Corporation.
**
**                                             E-Mail: ChinaFengliang@163.com
**
**
**---------File Information-------------------------------------------------------------------------------------------
** File name:            uart1.c
** Last version:         V1.00
** Descriptions:         uart1驱动文件.
** Hardware platform:    lpc2460
** SoftWare platform:    
**
**--------------------------------------------------------------------------------------------------------------------
** Created by:           FengLiang
** Created date:         2011年2月19日  21:23:48
** Version:              V1.00
** Descriptions:         The original version
**
**--------------------------------------------------------------------------------------------------------------------
** Modified by: 
** Modified date:
** Version:
** Descriptions:
**
*********************************************************************************************************************/

/*********************************************************************************************************************
                                                    头文件区
*********************************************************************************************************************/
#include    "../../../include/OS_macro.h"
#include    "../../../include/OS_types.h"
#include    "../../../include/lpc24xx.h"
#include    "../../../libuary/regist.h"
#include    "../uart.h"

/*********************************************************************************************************************
                                                    宏定义区
*********************************************************************************************************************/
/* 宏段名 ----------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                    类型定义区
*********************************************************************************************************************/
/* 基本类型 --------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                  全局变量定义区
*********************************************************************************************************************/
static const UART_INFO uart1_info =
{
    0xE0010000,                                                             /* 寄存器基址                           */
};


/*********************************************************************************************************************
** Function name:           uart1_setup
** Descriptions:            安装uart1设备
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  21:33:43
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static STATUS uart1_setup(int Speed)
{
    STATUS          Status;
    /* 1)
     * 私有构建过程
     */
    regist_set_bits(PCONP, 1ul<<4);                                         /* 使能uart1外设备供电                  */ 
    regist_modify(PCLKSEL0, 1ul<<9, 1ul<<8);                                /* 设置串口1分频系数: Fuart1 = Fcpu / 1 */
    regist_set_bits(PINSEL0, (1ul<<4) |                                     /* 设置P0.2功能: RXD0                   */
                             (1ul<<6));                                     /* 设置P0.3功能: TXD0                   */
    /* 2)
     * 类构建过程
     */
    Status = uart_setup(&uart1_info, Speed);
    
    return Status;
}


/*********************************************************************************************************************
** Function name:           uart1_cleanup
** Descriptions:            卸载uart1设备
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:33:1
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static STATUS uart1_cleanup(void)
{
    regist_clr_bits(PCONP, 1ul<<4);                                         /* 禁能uart1外设备供电                  */
    
    return OS_OK;
}

/*********************************************************************************************************************
** Function name:           uart1_send
** Descriptions:            发送数据
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:40:50
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static INT32S uart1_send(char *pBuffer, int Size)
{
    uart_send(&uart1_info, pBuffer, Size);
    return OS_OK;
}

/*********************************************************************************************************************
** Function name:           uart1_recv
** Descriptions:            接收数据
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:42:13
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static INT32S uart1_recv(char *pBuffer, int Size)
{
    uart_recv(&uart1_info, pBuffer, Size);
    return OS_OK;
}

/*********************************************************************************************************************
                                                    设备定义区
*********************************************************************************************************************/
const CLASS_UART        uart1 =                                             /* 设备: uart1                          */
{
    uart1_setup,
    uart1_cleanup,
    uart1_send,
    uart1_recv
};

/*********************************************************************************************************************
                                                    END OF FILE
*********************************************************************************************************************/

