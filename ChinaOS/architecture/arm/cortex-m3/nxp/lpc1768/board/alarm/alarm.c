/******************************************************Copyright (c)**************************************************
**                                              胆怯是阻止一切可能的根本缘由
**
**                                             E-Mail: ChinaFengliang@163.com
**
**---------File Information-------------------------------------------------------------------------------------------
** File name:            alarm.c
** Last version:         V1.00
** Descriptions:         报警器驱动文件.
** Hardware platform:    lpc1768之pin(1.18)
** SoftWare platform:    ChinaOS
**
**--------------------------------------------------------------------------------------------------------------------
** Created by:           Fengliang
** Created date:         2010年10月13日  14:10:22
** Version:              V1.00
** Descriptions:         The original version
**
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Version:
** Descriptions:
**
*********************************************************************************************************************/

/*********************************************************************************************************************
                                                    头文件区
*********************************************************************************************************************/
#include    <OS_macro.h>
#include    <OS_types.h>
#include    <libuary/regist.h>
#include    "../../lpc17xx.h"
#include    "./alarm.h"

/*********************************************************************************************************************
                                                    宏定义区
*********************************************************************************************************************/
/* 宏段名 ----------------------------------------------------------------------------------------------------------*/
#define PINSEL7                 (0x4002C01C)
#define FIO3DIR                 (0x2009c060)
#define FIO3SET                 (0x2009c078)
#define FIO3CLR                 (0x2009c07c)

/*********************************************************************************************************************
                                                    类型定义区
*********************************************************************************************************************/
/* 基本类型 --------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                  全局变量定义区
*********************************************************************************************************************/


/*********************************************************************************************************************
** Function name:           alarm_setup
** Descriptions:            安装报警器
** Input parameters:        none
** Output parameters:       none
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2010-10-13  14:30:0
** Test recorde:
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde:
*********************************************************************************************************************/
static int alarm_setup(void)
{
    /* 蜂鸣器控制引脚: p3.26 */
    dword_clr_bits(PINSEL7, 3ul<<20);                                       /* 配置引脚p1.18功能: GPIO              */
    dword_set_bits(FIO3DIR, 1ul << 26);                                     /* 配置引脚p1.18方向: 输出              */
    write_dword(FIO3SET, 1ul << 26);                                        /* 初始状态:关闭                        */

    return OS_OK;
}

/*********************************************************************************************************************
** Function name:           alarm_on
** Descriptions:            报警器鸣响
** Input parameters:        none
** Output parameters:       none
** Returned value:          none
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2010-10-13  14:30:35
** Test recorde:
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde:
*********************************************************************************************************************/
static void alarm_on(void)
{
    write_dword(FIO3CLR, 1ul << 26);
}

/*********************************************************************************************************************
** Function name:           alarm_off
** Descriptions:            关闭报警器
** Input parameters:        none
** Output parameters:       none
** Returned value:          none
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2010-10-13  14:30:43
** Test recorde:
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde:
*********************************************************************************************************************/
static void alarm_off(void)
{
    write_dword(FIO3SET, 1ul << 26);       
}

/*********************************************************************************************************************
                                                    设备定义区
*********************************************************************************************************************/
const CLASS_ALARM alarm =                                                   /* 设备: 报警器                         */
{
    alarm_setup,
    alarm_on,
    alarm_off,
};

/*********************************************************************************************************************
                                                    END OF FILE
*********************************************************************************************************************/

