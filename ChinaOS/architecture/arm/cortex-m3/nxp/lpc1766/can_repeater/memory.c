/******************************************************Copyright (c)**************************************************
**                                              胆怯是阻止一切可能的根本缘由
**
**                                             E-Mail: ChinaFengliang@163.com
**
**---------File Information-------------------------------------------------------------------------------------------
** File name:            memory.c
** Last version:         V1.00
** Descriptions:         .
** Hardware platform:    
** SoftWare platform:    ChinaOS
**
**--------------------------------------------------------------------------------------------------------------------
** Created by:           Feng Liang
** Created date:         2012-12-5  12:19:42
** Version:              V1.00
** Descriptions:         The original version.
**
**--------------------------------------------------------------------------------------------------------------------
** Modified by:          
** Modified date:        
** Version:              
** Descriptions:         
**
*********************************************************************************************************************/

/*********************************************************************************************************************
                                                    INPUT FILES
*********************************************************************************************************************/
#include    <include/macro.h>
#include    <include/types.h>
#include    <library/memory.h>
#include    <library/printk.h>

/*********************************************************************************************************************
                                                  MACRO DEFINITIONS
*********************************************************************************************************************/
/* section ---------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                  TYPE DEFINITIONS
*********************************************************************************************************************/
/* section ---------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                  GLOBAL VARIABLES
*********************************************************************************************************************/
extern void                *Image$$HeapBase1$$Base;                         /* 堆区1基址                            */
extern void                *Image$$HeapBase2$$Base;                         /* 堆区2基址                            */

const SEGMENT               aMemorySegments[] =                             /* 内存段列表                           */
{
    {&Image$$HeapBase1$$Base, (void *)0x10008000},
    {&Image$$HeapBase2$$Base, (void *)0x20084000},
};
const int                   NumOfHeap = ARRAY_SIZE(aMemorySegments);        

/*********************************************************************************************************************
** Function name:           heap
** Descriptions:            查看内存堆信息
** Input parameters:        
** Output parameters:       
** Returned value:          ==OK : 操作成功
**                          !=OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Feng Liang
** Created Date:            2011-12-4  15:40:57
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
int heap(char *Option)
{
    int         i;


    for (i = 0; i < sizeof(aMemorySegments)/sizeof(SEGMENT); i++)
    {
        printk("内存空间%d:[0x%X,0x%X) 共%dK字节\r\n", i, 
               (INT32U)aMemorySegments[i].pStartAddr, (INT32U)aMemorySegments[i].pEndAddr, 
               (((INT32U)aMemorySegments[i].pEndAddr - (INT32U)aMemorySegments[i].pStartAddr)>>10));
    }
    
    return OK;
}
EXPORT_TO_COMMAND("内存空间", heap);

/*********************************************************************************************************************
                                                    END OF FILE
*********************************************************************************************************************/

