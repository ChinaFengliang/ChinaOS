/******************************************************Copyright (c)**************************************************
**
**                              Copyright (c) 2009,2011 Fengliang And His Friends Corporation.
**
**                                             E-Mail: ChinaFengliang@163.com
**
**
**---------File Information-------------------------------------------------------------------------------------------
** File name:            uart3.c
** Last version:         V1.00
** Descriptions:         uart2驱动文件.
** Hardware platform:    lpc2460
** SoftWare platform:    
**
**--------------------------------------------------------------------------------------------------------------------
** Created by:           FengLiang
** Created date:         2011年2月19日  21:23:48
** Version:              V1.00
** Descriptions:         The original version
**
**--------------------------------------------------------------------------------------------------------------------
** Modified by: 
** Modified date:
** Version:
** Descriptions:
**
*********************************************************************************************************************/

/*********************************************************************************************************************
                                                    头文件区
*********************************************************************************************************************/
#include    "../../../include/OS_macro.h"
#include    "../../../include/OS_types.h"
#include    "../../../include/lpc24xx.h"
#include    "../../../libuary/regist.h"
#include    "../uart.h"

/*********************************************************************************************************************
                                                    宏定义区
*********************************************************************************************************************/
/* 宏段名 ----------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                    类型定义区
*********************************************************************************************************************/
/* 基本类型 --------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                  全局变量定义区
*********************************************************************************************************************/
static const UART_INFO uart3_info =
{
    0xE007C000,                                                             /* 寄存器基址                           */
};


/*********************************************************************************************************************
** Function name:           uart3_setup
** Descriptions:            安装uart2设备
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  21:33:43
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static STATUS uart3_setup(int Speed)
{
    STATUS          Status;
    /* 1)
     * 私有构建过程
     */
    regist_set_bits(PCONP, 1ul<<25);                                        /* 使能uart3外设备供电                  */ 
    regist_modify(PCLKSEL1, 1ul<<19, 1ul<<18);                              /* 设置串口3分频系数: Fuart3 = Fcpu / 1 */
    regist_set_bits(PINSEL9, (1ul<<24)|(1ul<<25)|                           /* 设置P4.29功能: RXD                   */
                             (1ul<<26)|(1ul<<27));                          /* 设置P4.28功能: TXD                   */
    /* 2)
     * 类构建过程
     */
    Status = uart_setup(&uart3_info, Speed);
    
    return Status;
}


/*********************************************************************************************************************
** Function name:           uart3_cleanup
** Descriptions:            卸载uart2设备
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:33:1
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static STATUS uart3_cleanup(void)
{
    regist_clr_bits(PCONP, 1ul<<25);                                        /* 禁能uart3外设备供电                  */
   
    return OS_OK;
}

/*********************************************************************************************************************
** Function name:           uart3_send
** Descriptions:            发送数据
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:40:50
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static INT32S uart3_send(char *pBuffer, int Size)
{
    uart_send(&uart3_info, pBuffer, Size);
    return OS_OK;
}

/*********************************************************************************************************************
** Function name:           uart3_recv
** Descriptions:            接收数据
** Input parameters:        
** Output parameters:       
** Returned value:          ==OS_OK : 操作成功
**                          !=OS_OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:42:13
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static INT32S uart3_recv(char *pBuffer, int Size)
{
    uart_recv(&uart3_info, pBuffer, Size);
    return OS_OK;
}

/*********************************************************************************************************************
                                                    设备定义区
*********************************************************************************************************************/
const CLASS_UART        uart3 =                                             /* 设备: uart3                          */
{
    uart3_setup,
    uart3_cleanup,
    uart3_send,
    uart3_recv
};

/*********************************************************************************************************************
                                                    END OF FILE
*********************************************************************************************************************/

