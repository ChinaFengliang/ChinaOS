/******************************************************Copyright (c)**************************************************
**
**                              Copyright (c) 2009,2011 Fengliang And His Friends Corporation.
**
**                                             E-Mail: ChinaFengliang@163.com
**
**
**---------File Information-------------------------------------------------------------------------------------------
** File name:            uart0.c
** Last version:         V1.00
** Descriptions:         uart0驱动文件.
** Hardware platform:    lpc2460
** SoftWare platform:    
**
**--------------------------------------------------------------------------------------------------------------------
** Created by:           FengLiang
** Created date:         2011年2月19日  21:23:48
** Version:              V1.00
** Descriptions:         The original version
**
**--------------------------------------------------------------------------------------------------------------------
** Modified by: 
** Modified date:
** Version:
** Descriptions:
**
*********************************************************************************************************************/

/*********************************************************************************************************************
                                                    头文件区
*********************************************************************************************************************/
#include    <include/macro.h>
#include    <include/types.h>
#include    <library/ioport.h>
#include    "../../lpc17xx.h"
#include    "../uart.h"

/*********************************************************************************************************************
                                                    宏定义区
*********************************************************************************************************************/
/* 宏段名 ----------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                    类型定义区
*********************************************************************************************************************/
/* 基本类型 --------------------------------------------------------------------------------------------------------*/


/*********************************************************************************************************************
                                                  全局变量定义区
*********************************************************************************************************************/
static const UART_INFO uart0_info =
{
    0x4000C000,                                                             /* 寄存器基址                           */
};


/*********************************************************************************************************************
** Function name:           uart0_setup
** Descriptions:            安装uart0设备
** Input parameters:        
** Output parameters:       
** Returned value:          ==OK : 操作成功
**                          !=OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  21:33:43
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static int uart0_setup(void)
{
    int          Status;
    /* 1)
     * 私有构建过程
     */
    dword_set_bits(PCONP, 1ul<<3);                                         	/* 使能uart0外设备供电                  */ 
    dword_modify(PINSEL0, (1ul<<7) | (1ul<<5),                            	/* 设置P0.2功能: RXD0                   */
                          (1ul<<6) | (1ul<<4));                         	/* 设置P0.3功能: TXD0                   */
    /* 2)
     * 类构建过程
     */
    Status = uart_setup(&uart0_info, 0);
    
    return Status;
}


/*********************************************************************************************************************
** Function name:           uart0_cleanup
** Descriptions:            卸载uart0设备
** Input parameters:        
** Output parameters:       
** Returned value:          ==OK : 操作成功
**                          !=OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:33:1
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static STATUS uart0_cleanup(void)
{
    dword_clear_bits(PCONP, 1ul<<3);                                         /* 禁能uart0外设备供电                  */
    
    return OK;
}

/*********************************************************************************************************************
** Function name:           uart0_send
** Descriptions:            发送数据
** Input parameters:        
** Output parameters:       
** Returned value:          ==OK : 操作成功
**                          !=OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:40:50
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static INT32S uart0_send(char *pBuffer, int Size)
{
    uart_send(&uart0_info, pBuffer, Size);
    return OK;
}

/*********************************************************************************************************************
** Function name:           uart0_recv
** Descriptions:            接收数据
** Input parameters:        
** Output parameters:       
** Returned value:          ==OK : 操作成功
**                          !=OK : 操作失败(包含出错信息)
**--------------------------------------------------------------------------------------------------------------------
** Created by:              Fengliang
** Created Date:            2011-2-19  22:42:13
** Test recorde:            
**--------------------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Test recorde: 
*********************************************************************************************************************/
static INT32S uart0_recv(char *pBuffer, int Size)
{
    uart_recv(&uart0_info, pBuffer, Size);
    return OK;
}

/*********************************************************************************************************************
                                                    设备定义区
*********************************************************************************************************************/
const CLASS_UART        uart0 =                                             /* 设备: uart0                          */
{
    uart0_setup,
    uart0_cleanup,
    uart0_send,
    uart0_recv
};
EXPORT_DEVICE(uart0, "串行通信口0");

/*********************************************************************************************************************
                                                    END OF FILE
*********************************************************************************************************************/

